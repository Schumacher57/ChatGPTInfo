–ö–æ–Ω–µ—á–Ω–æ! –í–æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `services.AddDbContextFactory` –≤ ASP.NET Core:

1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –í —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQL Server –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```csharp
public class ApplicationDbContext : DbContext
{
    public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options) : base(options)
    {
    }

    public DbSet<Customer> Customers { get; set; }

    // –î–æ–±–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π
}
```

2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Ñ–∞–±—Ä–∏–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –∏—Å–ø–æ–ª—å–∑—É—è `services.AddDbContextFactory` –≤ –º–µ—Ç–æ–¥–µ `ConfigureServices` –≤ —Ñ–∞–π–ª–µ `Startup.cs`:

```csharp
public void ConfigureServices(IServiceCollection services)
{
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    var connectionString = Configuration.GetConnectionString("DefaultConnection");

    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–±—Ä–∏–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    services.AddDbContextFactory<ApplicationDbContext>(options =>
    {
        options.UseSqlServer(connectionString);
    });

    // –î—Ä—É–≥–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤...
}
```

3. –í–Ω–µ–¥—Ä–∏—Ç–µ `IDbContextFactory<ApplicationDbContext>` –≤ —Å–≤–æ–π –∫–ª–∞—Å—Å, –≥–¥–µ –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```csharp
private readonly IDbContextFactory<ApplicationDbContext> _contextFactory;

public MyClass(IDbContextFactory<ApplicationDbContext> contextFactory)
{
    _contextFactory = contextFactory;
}

public void DoSomething()
{
    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é —Ñ–∞–±—Ä–∏–∫–∏
    using (var context = _contextFactory.CreateDbContext())
    {
        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        var customers = context.Customers.ToList();

        // –î—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
    }
}
```

–í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã —Å–æ–∑–¥–∞–ª–∏ —Ñ–∞–±—Ä–∏–∫—É `IDbContextFactory<ApplicationDbContext>`, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏ –µ–µ –≤ DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏ –≤–Ω–µ–¥—Ä–∏–ª–∏ –µ–µ –≤ –∫–ª–∞—Å—Å `MyClass`. –ó–∞—Ç–µ–º –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ñ–∞–±—Ä–∏–∫—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –∫–æ–¥–∞.

–ù–∞–¥–µ—é—Å—å, —ç—Ç–æ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–∏–º–µ—Ä –ø–æ–º–æ–≥–∞–µ—Ç –≤–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `services.AddDbContextFactory`! üöÄüëç
